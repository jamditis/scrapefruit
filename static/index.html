<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCRAPEFRUIT // SYS</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <!-- CRT scanline overlay -->
    <div class="crt-overlay"></div>
    <!-- Grid pattern background -->
    <div class="grid-pattern"></div>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i data-lucide="citrus"></i>
                    </div>
                    <div class="logo-text-group">
                        <span class="logo-text">SCRAPEFRUIT</span>
                        <span class="logo-version">SYS_v4.2</span>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-item active" data-view="jobs">
                    <i data-lucide="clipboard-list"></i>
                    <span>JOBS</span>
                </button>
                <button class="nav-item" data-view="results">
                    <i data-lucide="table"></i>
                    <span>RESULTS</span>
                </button>
                <button class="nav-item" data-view="settings">
                    <i data-lucide="settings"></i>
                    <span>SETTINGS</span>
                </button>
                <button class="nav-item" data-view="data">
                    <i data-lucide="database"></i>
                    <span>DATA</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <div class="status-indicator" id="status-indicator">
                    <span class="status-dot"></span>
                    <span class="status-text">SYSTEM READY</span>
                </div>
            </div>
        </aside>

        <!-- Main content -->
        <main class="main">
            <!-- Jobs view -->
            <div class="view active" id="view-jobs">
                <header class="view-header">
                    <div class="view-header-title">
                        <h1 class="glitch-text" data-text="ACTIVE_TASKS">ACTIVE_TASKS</h1>
                        <span class="view-header-sub">// Job_Management_Console</span>
                    </div>
                    <div class="view-actions">
                        <button class="btn btn-ghost" id="btn-refresh-jobs" title="Refresh jobs list">
                            <i data-lucide="refresh-cw"></i>
                        </button>
                        <button class="btn btn-primary" id="btn-new-job">
                            <i data-lucide="plus"></i>
                            NEW_TASK
                        </button>
                    </div>
                </header>

                <div class="jobs-container">
                    <div class="jobs-list" id="jobs-list">
                        <!-- Jobs will be rendered here -->
                        <div class="empty-state" id="jobs-empty">
                            <div class="empty-icon">ðŸ“‹</div>
                            <h3>No jobs yet</h3>
                            <p>Create your first scraping job to get started</p>
                        </div>
                    </div>

                    <div class="job-detail" id="job-detail">
                        <!-- Job details panel -->
                        <div class="detail-placeholder">
                            <p>Select a job to view details</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results view -->
            <div class="view" id="view-results">
                <header class="view-header">
                    <div class="view-header-title">
                        <h1 class="glitch-text" data-text="DATA_MATRIX">DATA_MATRIX</h1>
                        <span class="view-header-sub">// Extraction_Results</span>
                    </div>
                    <div class="view-actions">
                        <select id="results-job-select" class="select">
                            <option value="">Select a job...</option>
                        </select>
                        <button class="btn btn-ghost" id="btn-refresh-results" title="Refresh results">
                            <i data-lucide="refresh-cw"></i>
                        </button>
                        <button class="btn btn-secondary" id="btn-export-json">EXP_JSON</button>
                        <button class="btn btn-secondary" id="btn-export-csv">EXP_CSV</button>
                    </div>
                </header>

                <div class="results-container" id="results-container">
                    <div class="results-empty">
                        <p>Select a job to view results</p>
                    </div>
                </div>
            </div>

            <!-- Settings view -->
            <div class="view" id="view-settings">
                <header class="view-header">
                    <div class="view-header-title">
                        <h1 class="glitch-text" data-text="CONFIGURATION">CONFIGURATION</h1>
                        <span class="view-header-sub">// System_Parameters</span>
                    </div>
                </header>

                <div class="settings-container">
                    <section class="settings-section">
                        <h2>Appearance</h2>
                        <p class="section-desc">Customize the look and feel of Scrapefruit.</p>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label for="setting-theme">
                                    Theme
                                    <span class="tooltip" data-tip="Choose a color scheme that suits your preference. Changes apply instantly.">?</span>
                                </label>
                                <select id="setting-theme" class="select">
                                    <option value="citrus-dark">Citrus dark</option>
                                    <option value="midnight">Midnight blue</option>
                                    <option value="forest">Forest</option>
                                    <option value="rose">RosÃ©</option>
                                    <option value="light">Light</option>
                                    <option value="high-contrast">High contrast</option>
                                </select>
                                <span class="setting-help">Changes are applied immediately</span>
                            </div>
                        </div>
                    </section>

                    <section class="settings-section">
                        <h2>Scraping behavior</h2>
                        <p class="section-desc">Control how the scraper fetches pages and handles failures.</p>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label for="setting-timeout">
                                    Request timeout (ms)
                                    <span class="tooltip" data-tip="How long to wait for a page to load before giving up. Increase for slow sites.">?</span>
                                </label>
                                <input type="number" id="setting-timeout" class="input" value="30000">
                                <span class="setting-help">30000 = 30 seconds</span>
                            </div>
                            <div class="setting-item">
                                <label for="setting-retries">
                                    Retry count
                                    <span class="tooltip" data-tip="Number of times to retry a failed request before marking it as failed.">?</span>
                                </label>
                                <input type="number" id="setting-retries" class="input" value="3">
                                <span class="setting-help">Retries on timeout or error</span>
                            </div>
                            <div class="setting-item">
                                <label for="setting-delay-min">
                                    Minimum delay (ms)
                                    <span class="tooltip" data-tip="Shortest wait time between requests. Helps avoid rate limits.">?</span>
                                </label>
                                <input type="number" id="setting-delay-min" class="input" value="1000">
                                <span class="setting-help">1000 = 1 second</span>
                            </div>
                            <div class="setting-item">
                                <label for="setting-delay-max">
                                    Maximum delay (ms)
                                    <span class="tooltip" data-tip="Longest wait time between requests. Random delay between min/max looks more human.">?</span>
                                </label>
                                <input type="number" id="setting-delay-max" class="input" value="3000">
                                <span class="setting-help">3000 = 3 seconds</span>
                            </div>
                            <div class="setting-item setting-toggle">
                                <label for="setting-stealth">
                                    Use stealth mode
                                    <span class="tooltip" data-tip="Disguises the browser to avoid bot detection. Uses Playwright with anti-fingerprinting.">?</span>
                                </label>
                                <input type="checkbox" id="setting-stealth" checked>
                                <span class="setting-help">Helps bypass anti-bot measures</span>
                            </div>
                            <div class="setting-item setting-toggle">
                                <label for="setting-rotate-ua">
                                    Rotate user agents
                                    <span class="tooltip" data-tip="Use different browser identities for each request to look like different users.">?</span>
                                </label>
                                <input type="checkbox" id="setting-rotate-ua" checked>
                                <span class="setting-help">Changes browser identity per request</span>
                            </div>
                        </div>
                    </section>

                    <section class="settings-section">
                        <h2>Default output</h2>
                        <p class="section-desc">Configure default export format and auto-save behavior.</p>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label for="setting-output-format">
                                    Default format
                                    <span class="tooltip" data-tip="File format for exported results. JSON preserves structure, CSV works in spreadsheets.">?</span>
                                </label>
                                <select id="setting-output-format" class="select">
                                    <option value="json">JSON</option>
                                    <option value="csv">CSV</option>
                                </select>
                                <span class="setting-help">Format for downloaded results</span>
                            </div>
                            <div class="setting-item">
                                <label for="setting-output-dir">
                                    Auto-save directory
                                    <span class="tooltip" data-tip="Folder where results are automatically saved when a job completes. Leave empty to disable.">?</span>
                                </label>
                                <input type="text" id="setting-output-dir" class="input" placeholder="Leave empty to disable">
                                <span class="setting-help">Optional: auto-export on completion</span>
                            </div>
                            <div class="setting-item setting-toggle">
                                <label for="setting-auto-export">
                                    Auto-export on complete
                                    <span class="tooltip" data-tip="Automatically save results when a job finishes. Requires a save directory.">?</span>
                                </label>
                                <input type="checkbox" id="setting-auto-export">
                                <span class="setting-help">Save results automatically</span>
                            </div>
                        </div>
                    </section>

                    <div class="settings-actions">
                        <button class="btn btn-primary" id="btn-save-settings">Save settings</button>
                        <button class="btn btn-ghost" id="btn-reset-settings">Reset to defaults</button>
                    </div>
                </div>
            </div>

            <!-- Data view -->
            <div class="view" id="view-data">
                <header class="view-header">
                    <div class="view-header-title">
                        <h1 class="glitch-text" data-text="DATABASE">DATABASE</h1>
                        <span class="view-header-sub">// Raw_Data_Inspector</span>
                    </div>
                    <div class="view-actions">
                        <button class="btn btn-ghost" id="btn-refresh-data" title="Refresh data">
                            <i data-lucide="refresh-cw"></i>
                        </button>
                    </div>
                </header>

                <div class="data-container">
                    <!-- Table browser section -->
                    <section class="data-section">
                        <div class="data-toolbar">
                            <label for="data-table-select">Table:</label>
                            <select id="data-table-select" class="select">
                                <option value="">Loading...</option>
                            </select>
                            <span class="data-row-count" id="data-row-count"></span>
                        </div>

                        <div class="data-schema" id="data-schema">
                            <span class="schema-label">Schema:</span>
                            <span class="schema-columns" id="schema-columns">Select a table</span>
                        </div>

                        <div class="data-table-wrapper">
                            <table class="data-table" id="data-table">
                                <thead id="data-table-head"></thead>
                                <tbody id="data-table-body"></tbody>
                            </table>
                        </div>

                        <div class="data-pagination" id="data-pagination">
                            <button class="btn btn-ghost btn-sm" id="btn-prev-page" disabled>&lt; Prev</button>
                            <span class="pagination-info" id="pagination-info">Page 1</span>
                            <button class="btn btn-ghost btn-sm" id="btn-next-page" disabled>Next &gt;</button>
                        </div>
                    </section>

                    <!-- SQL console section -->
                    <section class="data-section sql-section">
                        <h3>SQL console</h3>
                        <p class="section-desc">Run SELECT queries directly against the database.</p>
                        <textarea id="sql-input" class="sql-input" rows="4" placeholder="SELECT * FROM jobs LIMIT 10"></textarea>
                        <div class="sql-actions">
                            <button class="btn btn-primary" id="btn-execute-sql">Execute</button>
                            <span class="sql-status" id="sql-status"></span>
                        </div>
                        <div class="sql-results" id="sql-results">
                            <div class="sql-results-empty">Run a query to see results</div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <!-- New Job Modal -->
    <div class="modal" id="modal-new-job">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create new job</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="job-name">
                        Job name
                        <span class="tooltip" data-tip="A descriptive name to identify this scraping job.">?</span>
                    </label>
                    <input type="text" id="job-name" class="input" placeholder="My scraping job">
                </div>
                <div class="form-group">
                    <label for="job-mode">
                        Mode
                        <span class="tooltip" data-tip="URL list: scrape specific pages. Single: one page. Crawl: discover pages automatically.">?</span>
                    </label>
                    <select id="job-mode" class="select">
                        <option value="list">URL list - Scrape a list of specific URLs</option>
                        <option value="single">Single URL - Scrape one page</option>
                        <option value="crawl">Crawl - Find and scrape pages (coming soon)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="job-urls">
                        URLs (one per line)
                        <span class="tooltip" data-tip="Paste your target URLs here, one URL per line. Must start with http:// or https://.">?</span>
                    </label>
                    <textarea id="job-urls" class="textarea" rows="8" placeholder="https://example.com/page1&#10;https://example.com/page2"></textarea>
                    <span class="setting-help">Tip: You can paste from a spreadsheet column</span>
                </div>

                <!-- Cascade scraping settings -->
                <div class="form-section">
                    <div class="form-section-header" id="cascade-toggle">
                        <label>
                            Advanced: Cascade scraping
                            <span class="tooltip" data-tip="Configure fallback methods when scraping fails. The system tries each method in order until one succeeds.">?</span>
                        </label>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="form-section-content" id="cascade-settings" style="display: none;">
                        <div class="form-group form-check">
                            <input type="checkbox" id="cascade-enabled" checked>
                            <label for="cascade-enabled">Enable cascade fallback</label>
                            <span class="setting-help">Try alternative methods when scraping fails</span>
                        </div>
                        <div class="form-group">
                            <label>Scraping methods (drag to reorder)</label>
                            <div class="cascade-methods" id="cascade-methods">
                                <div class="cascade-method" data-method="http">
                                    <input type="checkbox" id="method-http" checked>
                                    <span class="method-handle">â‹®â‹®</span>
                                    <label for="method-http">HTTP</label>
                                    <span class="method-desc">Fast, basic requests</span>
                                </div>
                                <div class="cascade-method" data-method="playwright">
                                    <input type="checkbox" id="method-playwright" checked>
                                    <span class="method-handle">â‹®â‹®</span>
                                    <label for="method-playwright">Playwright</label>
                                    <span class="method-desc">JS rendering + stealth</span>
                                </div>
                                <div class="cascade-method" data-method="puppeteer">
                                    <input type="checkbox" id="method-puppeteer" checked>
                                    <span class="method-handle">â‹®â‹®</span>
                                    <label for="method-puppeteer">Puppeteer</label>
                                    <span class="method-desc">Alternative browser</span>
                                </div>
                                <div class="cascade-method" data-method="agent_browser">
                                    <input type="checkbox" id="method-agent-browser">
                                    <span class="method-handle">â‹®â‹®</span>
                                    <label for="method-agent-browser">Agent Browser</label>
                                    <span class="method-desc">AI-optimized (requires CLI)</span>
                                </div>
                            </div>
                            <span class="setting-help">Order determines which methods are tried first</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="btn-create-job">Create job</button>
            </div>
        </div>
    </div>

    <!-- Add Rule Modal -->
    <div class="modal" id="modal-add-rule">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add extraction rule</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-desc">Define what data to extract from each page. Use browser DevTools to find selectors.</p>
                <div class="form-group">
                    <label for="rule-name">
                        Field name
                        <span class="tooltip" data-tip="The name for this data in your results, like 'title' or 'price'. Use lowercase with no spaces.">?</span>
                    </label>
                    <input type="text" id="rule-name" class="input" placeholder="title">
                    <span class="setting-help">Example: title, price, description</span>
                </div>
                <div class="form-group">
                    <label for="rule-type">
                        Selector type
                        <span class="tooltip" data-tip="CSS selectors are easier (like 'h1.title'). XPath is more powerful for complex cases.">?</span>
                    </label>
                    <select id="rule-type" class="select">
                        <option value="css">CSS selector (recommended)</option>
                        <option value="xpath">XPath (advanced)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="rule-selector">
                        Selector
                        <span class="tooltip" data-tip="The pattern to find elements. CSS example: 'h1.title' or 'div.price span'. Right-click elements in DevTools to copy selectors.">?</span>
                    </label>
                    <input type="text" id="rule-selector" class="input" placeholder="h1.title or .product-price">
                    <span class="setting-help">Tip: Right-click element in DevTools > Copy > Copy selector</span>
                </div>
                <div class="form-group">
                    <label for="rule-attribute">
                        Attribute (optional)
                        <span class="tooltip" data-tip="Leave empty to get text content. Use 'href' for links, 'src' for images, 'title' for tooltips.">?</span>
                    </label>
                    <input type="text" id="rule-attribute" class="input" placeholder="href, src, title, etc.">
                    <span class="setting-help">Leave empty to get text content</span>
                </div>
                <div class="form-row">
                    <div class="form-group form-check">
                        <input type="checkbox" id="rule-required">
                        <label for="rule-required">
                            Required
                            <span class="tooltip" data-tip="If checked, pages without this field will be marked as failed.">?</span>
                        </label>
                    </div>
                    <div class="form-group form-check">
                        <input type="checkbox" id="rule-list">
                        <label for="rule-list">
                            Extract all matches
                            <span class="tooltip" data-tip="Get all matching elements as a list, instead of just the first one.">?</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="btn-save-rule">Add rule</button>
            </div>
        </div>
    </div>

    <!-- Suggestions Modal -->
    <div class="modal" id="modal-suggestions">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>Suggested extraction rules</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-desc">Select the fields you want to extract. Rules are auto-detected from your HTML samples.</p>
                <div class="suggestions-list" id="suggestions-list">
                    <!-- Generated checkboxes with previews -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="btn-add-selected-rules">Add selected rules</button>
            </div>
        </div>
    </div>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/state.js"></script>
    <script src="/static/js/components/cascade-settings.js"></script>
    <script src="/static/js/components/job-manager.js"></script>
    <script src="/static/js/components/rules-editor.js"></script>
    <script src="/static/js/components/results-view.js"></script>
    <script src="/static/js/components/activity-log.js"></script>
    <script src="/static/js/components/sample-analyzer.js"></script>
    <script src="/static/js/components/data-view.js"></script>
    <script src="/static/js/app.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Re-initialize icons when DOM changes (for dynamically added content)
        const iconObserver = new MutationObserver(() => {
            lucide.createIcons();
        });
        iconObserver.observe(document.body, { childList: true, subtree: true });
    </script>
</body>
</html>
