name: Deploy to Raspberry Pi

on:
  push:
    branches:
      - master
  workflow_dispatch:  # Allow manual trigger

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Deploy to Pi
        run: |
          set -e  # Exit on any error

          echo "Deploying to Raspberry Pi..."

          # SSH to Pi and deploy
          ssh jamditis@houseofjawn.local << 'ENDSSH'
            set -e
            cd /home/jamditis/projects/scrapefruit

            echo "Pulling latest changes..."
            git fetch origin
            git reset --hard origin/master

            echo "Restarting service..."
            sudo systemctl restart scrapefruit

            echo "Deployed successfully at $(date)"
          ENDSSH
